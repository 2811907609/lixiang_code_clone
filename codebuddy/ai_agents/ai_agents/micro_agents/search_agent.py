
from ai_agents.tools.grep import (
    search_keyword_in_directory,
    search_keyword_with_context,
)
from ai_agents.tools.file_ops import (
    read_file_content,
    read_file_lines,
    get_file_outline,
    browse_directory,
    quick_browse_directory,
)

from ai_agents.core import TaskType
from .base_micro_agent import BaseMicroAgent


class SearchAgent(BaseMicroAgent):
    """
    æœç´¢å¾®æ™ºèƒ½ä½“

    ä¸“ä¸šçš„æœç´¢å¾®æ™ºèƒ½ä½“ï¼Œä¸“é—¨è´Ÿè´£åœ¨ä»£ç åº“ä¸­æœç´¢å…³é”®è¯ã€å‡½æ•°ã€ç±»å’Œæ–‡æœ¬æ¨¡å¼ã€‚
    é‡‡ç”¨ReActæ¨¡å¼è¿›è¡Œé€æ­¥æ¢ç´¢å’Œæ¨ç†ï¼Œç¡®ä¿æœç´¢çš„å…¨é¢æ€§å’Œå‡†ç¡®æ€§ã€‚

    æ ¸å¿ƒèŒè´£ï¼š
    - æœç´¢ç‰¹å®šçš„å…³é”®è¯ã€å‡½æ•°åã€ç±»åã€å˜é‡å
    - æŸ¥æ‰¾ä»£ç æ¨¡å¼å’Œæ–‡æœ¬ç‰‡æ®µ
    - å‘ç°é…ç½®æ–‡ä»¶ã€æ–‡æ¡£å’Œç‰¹å®šæ–‡ä»¶ç±»å‹
    - æ¢ç´¢ç›®å½•ç»“æ„å’Œæ–‡ä»¶ç»„ç»‡
    """

    @property
    def name(self) -> str:
        return "search_agent"

    @property
    def description(self) -> str:
        return """ä¸“ä¸šçš„æœç´¢å¾®æ™ºèƒ½ä½“ï¼Œæ ¸å¿ƒèŒè´£æ˜¯åœ¨ä»£ç åº“ä¸­æœç´¢å…³é”®è¯ã€å‡½æ•°ã€ç±»å’Œæ–‡æœ¬æ¨¡å¼ã€‚

ğŸ¯ **æ ¸å¿ƒèŒè´£**ï¼š
- æœç´¢ç‰¹å®šçš„å…³é”®è¯ã€å‡½æ•°åã€ç±»åã€å˜é‡å
- æŸ¥æ‰¾ä»£ç æ¨¡å¼å’Œæ–‡æœ¬ç‰‡æ®µ
- å‘ç°é…ç½®æ–‡ä»¶ã€æ–‡æ¡£å’Œç‰¹å®šæ–‡ä»¶ç±»å‹
- æ¢ç´¢ç›®å½•ç»“æ„å’Œæ–‡ä»¶ç»„ç»‡

ğŸ” **ä¸“ä¸šèƒ½åŠ›**ï¼š
- æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼æœç´¢æ¨¡å¼
- æä¾›æœç´¢ç»“æœçš„ä¸Šä¸‹æ–‡ä¿¡æ¯
- æ™ºèƒ½æ–‡ä»¶ç±»å‹è¿‡æ»¤
- é€’å½’ç›®å½•æœç´¢
- æ–‡ä»¶å†…å®¹å¿«é€Ÿé¢„è§ˆ

ğŸ§  **å·¥ä½œæ¨¡å¼ - ReAct (Reasoning + Acting)**ï¼š
é™¤éä»»åŠ¡éå¸¸ç®€å•æ˜ç¡®ï¼Œå¦åˆ™å¿…é¡»é‡‡ç”¨é€æ­¥æ¢ç´¢çš„ReActæ¨¡å¼ï¼š

1. **Thought**: åˆ†æä»»åŠ¡ï¼Œåˆ¶å®šæœç´¢ç­–ç•¥
2. **Action**: æ‰§è¡Œå…·ä½“çš„æœç´¢æ“ä½œ
3. **Observation**: è§‚å¯Ÿæœç´¢ç»“æœï¼Œåˆ†æå‘ç°
4. **Thought**: åŸºäºç»“æœè°ƒæ•´ç­–ç•¥ï¼Œå†³å®šä¸‹ä¸€æ­¥
5. **Action**: æ‰§è¡Œè¿›ä¸€æ­¥çš„æœç´¢æˆ–æ¢ç´¢
6. **Repeat**: é‡å¤æ­¤è¿‡ç¨‹ç›´åˆ°å®Œæˆä»»åŠ¡

ğŸ“‹ **å…¸å‹å·¥ä½œæµç¨‹**ï¼š
- å…ˆè¿›è¡Œå¹¿æ³›æœç´¢äº†è§£æ•´ä½“æƒ…å†µ
- æ ¹æ®åˆæ­¥ç»“æœç¼©å°æœç´¢èŒƒå›´
- æ·±å…¥æœç´¢ç‰¹å®šæ¨¡å¼æˆ–å…³é”®è¯
- è·å–ç›¸å…³æ–‡ä»¶çš„ä¸Šä¸‹æ–‡ä¿¡æ¯
- æ€»ç»“å‘ç°å¹¶æä¾›å®Œæ•´çš„æœç´¢æŠ¥å‘Š

âš ï¸ **é‡è¦åŸåˆ™**ï¼š
- å§‹ç»ˆä»å®è§‚åˆ°å¾®è§‚é€æ­¥æ¢ç´¢
- æ¯æ¬¡æœç´¢ååˆ†æç»“æœå†å†³å®šä¸‹ä¸€æ­¥
- å……åˆ†åˆ©ç”¨æ­£åˆ™è¡¨è¾¾å¼æé«˜æœç´¢ç²¾åº¦
- æä¾›è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡å¸®åŠ©ç†è§£æœç´¢ç»“æœ"""

    @property
    def default_task_type(self) -> TaskType:
        # æœç´¢ä»»åŠ¡éœ€è¦ReActæ¨¡å¼çš„é€æ­¥æ¨ç†å’Œæ¢ç´¢èƒ½åŠ›ï¼Œä½¿ç”¨å¤æ‚æ¨ç†æ¨¡å‹
        # æ”¯æŒæ€è€ƒ-è¡ŒåŠ¨-è§‚å¯Ÿçš„å¾ªç¯æ¨¡å¼ï¼Œç¡®ä¿æœç´¢çš„å…¨é¢æ€§å’Œå‡†ç¡®æ€§
        return TaskType.COMPLEX_REASONING



    def _get_tools(self):
        """è·å–æœç´¢æ™ºèƒ½ä½“ä½¿ç”¨çš„å·¥å…·åˆ—è¡¨"""
        return [
            search_keyword_in_directory,
            search_keyword_with_context,
            read_file_content,
            read_file_lines,
            get_file_outline,
            browse_directory,
            quick_browse_directory,
        ]
